name: Build
on: workflow_call
permissions: {}
jobs:
  build:
    strategy:
      matrix:
        artifact:
        - name: datapack
          make-target: build-datapack
          path-prefix: enderman-block
    # runs-on: ubuntu-24.04-arm
    runs-on: ubuntu-24.04
    name: ${{ matrix.artifact.name }}
    steps:
    - name: Harden runner
      uses: step-security/harden-runner@v2.11.0
      with:
        egress-policy: block
        allowed-endpoints: github.com:443 api.github.com:443 api.securityscorecards.dev:443 releases.nixos.org install.determinate.systems:443 cache.nixos.org:443 api.flakehub.com:443
    - name: Checkout repository
      uses: actions/checkout@v4.2.2
      with:
        persist-credentials: false
    - name: Setup nix
      uses: ./.github/actions/setup-nix
    - name: Build ${{ matrix.artifact.name }}
      run: nix develop .#build -c make ${{ matrix.artifact.make-target }}
    - name: Upload artifact
      uses: actions/upload-artifact@v4.6.1
      with:
        name: ${{ matrix.artifact.name }}
        path: ${{ matrix.artifact.path-prefix }}-*.zip
        include-hidden-files: true
        if-no-files-found: error
